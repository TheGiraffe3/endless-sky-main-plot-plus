mission "Neutrality 1"
    deadline 0
    invisible
    to offer
        "year" >= 2023
        not "chosen sides"
    source
        government "Republic" "Syndicate" "Free Worlds"
    on offer
        conversation
            `As you enter the bar, a man approaches you.`
            `"So, about that war between the Free Worlds and the Republic. Whose side are you on?"`
            label "whose side are you on"
            choice
                `"The Free Worlds!"`
                    goto "free worlds"
                `"The Republic!"`
                    goto "republic"
                `"The Syndicate!"`
                    goto "syndicate"
                `"Actually, none of them."`
                    goto "neutral"
                    to display
                        not "claimed neutrality"
                `No, I really am neutral.`
                    to display
                        has "claimed neutrality"
                `(Go someplace else)`
                    decline

            action
                event "pug notice neutrality" 5
            `"Huh. Well, I admire your resolve. Can't go wrong with that."`
                goto "end"

            label "free worlds"
            `"You support freedom and equality, eh? I prefer the Republic's order and stability."`
                goto "end"

            label "republic"
            `"You support order and stability, eh? So do I, so do I."`
                goto "end"

            label "syndicate"
            `"You support free markets and wealth, eh? Nothing wrong with that."`
                goto "end"

            label "neutral"
            action
                set "claimed neutrality"
            `The main looks taken aback.`
            `"No sides, eh? You have to pick a side!"`
                goto "whose side are you on"

            label "end"
            action
                clear "claimed neutrality"
            `The man leaves without another word.`
                decline

event "pug notice neutrality"

mission "Neutrality 2"
    invisible
    landing
    infiltrating
    to offer
        has "event: pug notice neutrality"
        or
            has "pug reputation override"
            not "reputation: Pug" < 0
    source
        attributes "near pug"
    on offer
        clear "pug reputation override"
        conversation
            `As you try to land on <origin>, your ship throws a strange error message and starts moving away from the spaceport.`
            choice
                `(Try to regain control)`
                `(Don't try to regain control)`
                    goto "remote landing"

            `You try to regain control of your ship manually, but it doesn't respond to your inputs.`

            label "remote landing"
            `Your ship comes to a stop in a remote location.`
            `Shortly after, strange, yellow, alien ships uncloak next to you. But it's what comes out of these ships that's really weird: pale aliens with strange proportions, large heads, and long arms and legs compared to their short, cylindrical torsoes. As they walk towards your ship, their gait appears somewhat similar to that of insects.`
            `"So you don't want to fight your war?" asks one of the aliens.`

            label "are you neutral"
            choice
                `"No."`
                    goto "neutral"
                `"Actually, yes."`
                    goto "changed mind"
                `"It's not my war."`
                    to display
                        not "neutral: war independent"

            action
                set "neutral: war independent"
            `"Oh, but it is. Just because you aren't actually fighting doesn't make it not your war. So, will you fight, or not?"`
                goto "are you neutral"

            label "changed mind"
            `"That's not what it seemed like to us. If that is really the case, we have no use here."`
            `The aliens depart. Your ship stops throwing the error message and also lets you depart.`
                flee

            label "neutral"
            action
                "reputation: Pug" >?= 0
            `"We have been monitoring your species closely, as there have been some unsettling developments. We noticed that you had resumed your use of nuclear weapons, weapons of genocide. We are glad that you have chosen the side of peace."`

            choice
                `"Who are you?"`
                    goto "pug"
                `"I wasn't the one who dropped nuclear weapons."`
                    to display
                        not "neutral: nuke independent"

            action
                set "neutral: nuke independent"
            `"And yet you have made no effort to discover who did."`
                to display
                    not "FW Katya 3: done"
            `"And yet you have made little effort to discover who did."`
                to display
                    has "FW Katya 3: done"
            choice
                `"Who are you?"`

            label "pug"
            `"We are Pug. Our goal is to bring peace and prevent your species from inflicting significant harm upon itself."`

            label "staff"
            action
                clear "neutral: nuke independent"
                clear "neutral: war independent"

            `"Your decision to avoid war is honorable, so we shall honor it."`
            `Without another word, a Pug rushes towards you and hits you with its staff. Everything blacks out.`
                accept

    on accept
        conversation
            # Adapted from the Ruin: Landing mission in endless sky, with major parts of the description copied.
            `You wake up inside of a tank, with an insectoid robot removing the lid. You step out onto an abandoned fueling depot: a ring of landing pads around a cluster of tanks of all different shapes and sizes. Some of them must be cyrogenic, because they are covered in ice. A few other slow-moving insectoid robots are busy clearing off the ice and cleaning the tanks, but they do not appear to be armed and you see no sign of any other creatures or of any defense systems. From the fact that some of the tanks are covered in frost and others are not, you would guess that each one, besides the one you were in, contains a different fuel, as each tank besides yours has dozens of different connectors branching off from it. You find your ship parked nearby, and with surprise, you discover that it is connected to one of the tanks, and the connector is the style used in human space. Other than the robots and the fog swirling in the valley below you, there is no sign of life or motion here, and the air is uncomfortably moist and cold despite the hot steam rising up from a few nearby vents in the ground.`
            `You power on your ship. When you look at your ship's clock, you notice that several years have passed, any time sensitive missions you may have had have been failed, and you have automatically received tribute and paid necessary salaries. It seems like you have been gone for much longer than you realized...`
        log "Interacted with aliens who call themselves the Pug, and met with some of them, then got kidnapped for what looks like several years. Was likely placed in a cyrogenic tank. The Pug say that they want to bring peace and protect humanity from excessive self-harm."
        log "Factions" "Pug" `The Pug are aliens with barrel-shaped bodies and spindly legs. They claim their goals are to bring humanity peace and protect humanity from excessive self-harm.`
        # As seen below, a lot of this makes no sense without two PRs being implemented. However, I am keeping this here for later. For now, use your imagination.
        dialog `Parts of this mission are dependent on future content which has not yet been released. To continue the campaign, please head to the planet 'Deneb' which should now be linked to the system you are in. It will assume you came from a wormhole and that a lot of time has passed, which will happen once the future content gets released.`
        # Requires relocate mission PR
        # relocate
        #     "flagship only"
        #     location
        #         Ruin

        # Requires time travel
        # "pass days" 1500
        # OR
        # "year" += 4

        set "chosen sides"
        event "fw zug expansion complete"
        event "oathkeepers founded"
        event "Tarazed neutrality"
        event "syndicate assistance"
        event "syndicate convoys to Tarazed"
        event "tarazed assistance"
        event "fw dirt belt patrols"
        event "plasma turret available"
        set "plasma turret available: done"
        event "fw conservatory founded"
        event "Thule becomes independent"
        event "Greenrock recovered"
        event "flamethrower available"
        event "navy occupying the south"
        event "catalytic ramscoop available"
        event "fw gets catalytic ramscoop"
        event "navy using mark ii ships"
        event "fw southern expansion"
        event "fw occupying the north"
        event "fw northern expansion"
        event "death of nguyen"
        event "dreadnoughts for sale"
        event "dreadnought deployment"
        event "bloodsea joins free worlds"
        event "bloodsea spaceport completed"
        event "albatross joins free worlds"
        event "fw expanded and cut"
        event "fw tarazed republic"
        event "deep sky tech available"
        event "navy out of rastaban"
        event "stack core for sale"
        event "fwc southern liberation"
        event "fwc capture kaus borealis"
        event "fwc capture cebalrai"
        # no nukes, you didn't fight for the free worlds
        event "fwc defended cebalrai"
        event "fwc capture menkent"
        event "fwc navy retakes cebalrai"
        event "pug flee"
        # patch because this plugin depends on the wormhole linking to the pleaides
        # the 1 is to prevent race conditions by ensuring it happens after 'pug flee'
        event "pug flee (patched)" 1
        event "fwc pug defeated"
        event "tribute patch"
        event "syndicate tech available"

        # This is merged with this mission so no need to offer it twice.
        set "Ruin: Landing: offered"

    on enter Deneb
        dialog `This appears to be a system in the middle of human space, just one jump away from where you were kidnapped, yet it is now linked to the rest of human space. You should probably land one of the two planets and try to figure out what is going on.`
        fail



mission "Neutrality 3"
    invisible
    # alt first last's home planet isn't dependent on what planets will let you land
    ignore clearance
    to offer
        has "skipped main plot"
    source
        system Deneb
    # For alt first last's home planet
    destination
        attributes "dirt belt"
        attributes "shipyard"
        not
            planet "New Boston"
    on offer
        # End part of log entries taken from log entries in free worlds checkmate
        log "It turns out the Pug invaded human space and cut neighboring hyperlinks, using the same claims about peace and protecting humanity as their justification for their invasion. The Free Worlds had nuclear weapons, which were no match for the Pug. Then, a Free Worlds captain was able to steal one of their 'jump drives', arouse the Navy, and restore hyperlinks. At least, that's what a receptionist on what used to be one their planets said when asked about it. It is possible that the true purpose of the Pug attack was to give human beings a common enemy that would force them to band together and forget their internal struggles."
        log "Factions" "Pug" "The Pug invaded human space and cut neighboring hyperlinks, using the same claims about peace and protecting humanity as their justification for their invasion. They were able to defeat a nuclear armed fleet, but a brave Free Worlds captain was able to steal one of their drives and reconnected the hyperspace lanes. When the Free Worlds and the Navy banded together to attack them, they disappeared into a wormhole, which goes to the planet the Pug released you onto. It is possible that the true purpose of their attack was to give human beings a common enemy that would force them to band together and forget their internal struggles."
        log "Factions" "Free Worlds" "During the war with the Pug, the Free Worlds had nuclear weapons. It is likely that this isn't the first time that they used them. After the Pug war, the Free Worlds was granted autonomy by the Republic."
        conversation
            `You decide to checkout the spaceport anyways, which looks just as alien as the rest of the planet. You approach what appears to be <origin>'s information kiosk, which looks significantly less alien.`
                to display
                    not "Neutrality 3b: declined"
            `Entering the spaceport, which looks just as alien as the rest of the planet, you approach what appears to be <origin>'s information kiosk, which looks significantly less alien.`
                to display
                    not "Neutrality 3b: declined"
            `"How can I help you?" asks the receptionist.`
            label "help"
            choice
                `"Why are there humans on an alien planet?"`
                    goto "humans"
                `"Why people were people gesturing towards the sky as I landed?"`

            `"Wait, are you Captain <last>? We had reports of a vessel associated with you coming from the wormhole," they explain, "and your ship appears to have last requested permission to land on a planet several years ago. Someone probably spread the word around to look for a ship looking like yours. What's going on?"`
            choice
                `"I was going to ask you the same thing. Why are there people on an alien planet?"`
                `"I was abducted by aliens who call themselves the Pug."`
                    goto "abducted"
                `"It's a long story."`

            `"Does this have something to do with the Pug?"`
            choice
                `"Actually, it does. They abducted me."`
                `"How do you know about the Pug?"`
                    goto "pug"

            label "abducted"
            `"Really? The ones who invaded human space?"`
            choice
                `"They invaded human space?"`
                `"They told me they wanted to preserve peace."`
                    goto "peace"

            `"Oh right, you probably don't know about that."`
                goto "pug"

            label "peace"
            `"That's what they said when they annexed Silver."`
                goto "pug"

            label "humans"
            `"You don't know? An alien race called the Pug attacked Silver, claiming that they were there to end the war and bring peace. They cut the hyperspace links from the other planets and connected them to this system instead. A few tried to resist, but not even the Free Worlds, with their nuclear weapons, were successful. At least, not at first. A brave captain from <planet> who was a member of the free worlds council stole a jump drive from them, like those that the Quarg use, that let them bypass hyperlanes. With this, they roused the Navy, reconnected the hyperspace lanes, and helped chase the Pug fleet back to this system. But when they got here, the Pug were gone, with only a strange wormhole in its place. Now the Free Worlds and the Republic are no longer at war, with the Free Worlds an autonomous part of the Republic, like the Syndicate. At least, that is what I have been told. Maybe that's what the Pug meant by 'peace.'"`
                goto "end"

            label "pug"
            `"The Pug attacked Silver, claiming that they were there to end the war and bring peace. They cut the hyperspace links from the other planets and connected them to this system instead. A few tried to resist, but not even the Free Worlds, with their nuclear weapons, were successful. At least, not at first. A brave captain from <planet> who was a member of the free worlds council stole a jump drive from them, like those that the Quarg use, that let them bypass hyperlanes. With this, they roused the Navy, reconnected the hyperspace lanes, and helped chase the Pug fleet back to this system. But when they got here, the Pug were gone, with that wormhole you came from in its place. Now the Free Worlds and the Republic are no longer at war, with the Free Worlds an autonomous part of the Republic, like the Syndicate. At least, that is what I have been told. Maybe that's what the Pug meant by 'peace.'"`
            `The receptionist pauses. "I'm not assuming they told you anything."`
            `"Not much," you admit.`

            label "end"
            `You thank the receptionist and head on your way, now knowing at least a little bit about what happened while you were gone.`
                decline
    on decline
        set "skipped main plot"
        set "main plot completed"
        set "free worlds checkmate"
        # TO DO: Fix hai reveal missions that assume you fought the Pug.
        set "Hai Reveal: Secret Leaks: offered"
        # You must discover that the free worlds produced plasma turrets in order to get the "proper" mission, but an updated one will be put in its place if you don't do so
        set "Heliarch Containment 5: offered"


# An affectionate parody of FWC Pug 2B: Pugglequat

mission "Neutrality 3a"
    invisible
    landing
    to offer
        has "skipped main plot"
        not "Neutrality 3: offered"
    source
        system Deneb
    on offer
        conversation
            `This planet was clearly one of the native Pug worlds. The architecture is entirely alien, yet you see people working here. As you land, you see people gesturing towards the sky, perhaps as a way of indicating that you should visit the other inhabited planet in this system.`
                decline

mission "Neutrality 3b"
    invisible
    landing
    to offer
        has "Neutrality 3a: declined"
        not "Neutrality 3: offered"
    source
        system Deneb
    on offer
        conversation
            `This planet was also clearly one of the native Pug worlds. Once again, architecture is entirely alien, yet you see people working here. As you land, you see more people gesturing towards the sky. Maybe this doesn't have to do with which planet you should visit. You should probably check the spaceport to see what is going on.`
                decline
